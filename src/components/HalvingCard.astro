---
import CountdownTimer from './CountdownTimer.astro';
import { getBlockCount, calculateHalvingData, type HalvingData } from '../lib/api';

let currentBlock = 0;
let halvingData: HalvingData;

try {
  currentBlock = await getBlockCount();
  halvingData = calculateHalvingData(currentBlock);
} catch (error) {
  console.error('Error fetching initial block data:', error);
  currentBlock = 0;
  halvingData = calculateHalvingData(0);
}
---

<div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 lg:p-12 max-w-4xl w-full mx-auto">
  <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-6 sm:mb-8 text-center">
    Scash Halving Countdown
  </h1>
  
  <div class="mb-6 sm:mb-8 md:mb-10">
    <CountdownTimer 
      nextHalvingDate={halvingData.nextHalvingDate}
    />
  </div>
  
  <div class="grid sm:grid-cols-2 gap-4 sm:gap-6">
    <div class="flex items-center gap-3 sm:gap-4">
      <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-scash-purple flex items-center justify-center flex-shrink-0">
        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
        </svg>
      </div>
      <div class="min-w-0 flex-1">
        <div class="text-xs sm:text-sm text-gray-600 mb-1">CURRENT BLOCK NUMBER</div>
        <div id="current-block" class="text-xl sm:text-2xl font-bold text-gray-900 break-words">
          {currentBlock.toLocaleString()}
        </div>
      </div>
    </div>
    
    <div class="flex items-center gap-3 sm:gap-4">
      <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-scash-purple flex items-center justify-center flex-shrink-0">
        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </div>
      <div class="min-w-0 flex-1">
        <div class="text-xs sm:text-sm text-gray-600 mb-1">NEXT HALVING DATE (Approx.)</div>
        <div id="next-halving-date" class="text-xl sm:text-2xl font-bold text-gray-900 break-words">
          {halvingData.nextHalvingDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
        </div>
        <div class="text-xs text-gray-500 mt-1 break-words">
          (Block {halvingData.nextHalvingBlock.toLocaleString()})
        </div>
      </div>
    </div>
  </div>
</div>

